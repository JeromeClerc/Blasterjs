$(document).ready(function(){function r(){for(var e=1;17>e;e++)if(13>e&&0!==parseInt(Grid[e])){var o=e+4;if(a(o)){t(e,o,Grid[e]);var n=!0}else if(parseInt(Grid[e])===parseInt(Grid[o])){d(e,o,Grid[e]);var n=!0}}return n?(r(),void 0):!1}function e(){for(var r=1;17>r;r++)if(r>4&&0!==parseInt(Grid[r])){var o=r-4;if(a(o)){t(r,o,Grid[r]);var n=!0}else if(parseInt(Grid[r])===parseInt(Grid[o])){d(r,o,Grid[r]);var n=!0}}return n?(e(),void 0):!1}function o(){for(var r=1;17>r;r++)if(1===parseInt(r)||5===parseInt(r)||9===parseInt(r)||13===parseInt(r))console.log("Already to the left side");else if(0!==parseInt(Grid[r])){var e=r-1;if(a(e)){t(r,e,Grid[r]);var n=!0}else if(parseInt(Grid[r])===parseInt(Grid[e])){d(r,e,Grid[r]);var n=!0}}return n?(o(),void 0):!1}function n(){for(var r=1;17>r;r++)if(4===parseInt(r)||8===parseInt(r)||12===parseInt(r)||16===parseInt(r))console.log("Already to the right side");else if(0!==parseInt(Grid[r])){var e=r+1;if(a(e)){t(r,e,Grid[r]);var o=!0}else if(parseInt(Grid[r])===parseInt(Grid[e])){d(r,e,Grid[r]);var o=!0}}return o?(n(),void 0):!1}function i(){for(var r=!0,e=1;17>e;e++)0===Grid[e]&&(r=!1);return r}function a(r){var e=!1;return 17>r&&0===Grid[r]?!0:e}function t(r,e,o){Grid[r]=0,Grid[e]=o}function d(r,e,o){Grid[r]=parseInt(0),Grid[e]=parseInt(o)+parseInt(o),p(o),y()}function p(r){var e=10*r;Score+=e,$("#score").empty().append(Score),2048===parseInt(r)&&c(!0)}function s(){Moves+=1,$("#moves").empty().append(Moves)}function f(){v(),l(),m(),u(),$(".end-game").hide()}function c(r){Game=!1,r===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}function l(){Grid=[];for(var r=0,e=0,o=1;401>o;o++)Grid.push({type:G(),coordX:r,coordY:e}),r===parseInt(380)?r=0:r+=20,0===o%20&&(e+=20)}function G(){return Math.floor(3*Math.random()+1)}function u(){var r=Math.floor(400*Math.random()+1);console.log("Recherche place libre, slot : "+r),1!==Grid[r].type?(console.log(Grid[r].type),console.log("Deja pris"),u()):(console.log("key : "+r),console.log("type : "+Grid[r].type),console.log("coordY : "+Grid[r].coordY),console.log("coordX : "+Grid[r].coordX),console.log("Terrain libre"),$("#grid-wrapper").append('<div class="perso" style="top:'+Grid[r].coordY+"px;left:"+Grid[r].coordX+'px;"><img src="images/drone-top.png"></div>'))}function v(){Game=!0}function I(){var r=Math.floor(16*Math.random()+1),e=Math.floor(100*Math.random()+1);0!==Grid[r]?I():Grid[r]=g(e),y()}function g(r){if(90>r)var e=2;else var e=4;return e}function y(){buildEmptyGrid();for(var r=1;17>r;r++)0!==Grid[r]&&$("#tile-"+r).addClass(TilesClass[Grid[r]]).empty().append(Grid[r])}function m(){$("#grid-wrapper").empty();for(var r in Grid)$("#grid-wrapper").append('<div class="tile" style="top:'+Grid[r].coordY+"px;left:"+Grid[r].coordX+'px;"><img src="images/'+h(Grid[r].type)+'"></div>')}function h(r){switch(r){case 1:var e="ground.jpg";break;case 2:var e="breakable-wall.jpg";break;case 3:var e="unbreakable-wall.jpg";break;default:var e="ground.jpg"}return e}KEY_DOWN=40,KEY_UP=38,KEY_LEFT=37,KEY_RIGHT=39,f(),$("body").on("click","a.button",function(){"new-game"===$(this).attr("role")&&f()}),$(document).on("keyup",function(a){Game&&(a.keyCode===KEY_LEFT&&(o()?I():i()?c(!1):I()),a.keyCode===KEY_RIGHT&&(n()?I():i()?c(!1):I()),a.keyCode===KEY_UP&&(e()?I():i()?c(!1):I()),a.keyCode===KEY_DOWN&&(r()?I():i()?c(!1):I()),(a.keyCode===KEY_LEFT||a.keyCode===KEY_DOWN||a.keyCode===KEY_UP||a.keyCode===KEY_RIGHT)&&s())}),$("#grid-wrapper").swipe({swipe:function(a,t){Game&&("left"===t&&(o()?I():i()?c(!1):I()),"right"===t&&(n()?I():i()?c(!1):I()),"up"===t&&(e()?I():i()?c(!1):I()),"down"===t&&(r()?I():i()?c(!1):I()),("left"===t||"right"===t||"up"===t||"down"===t)&&s())}})});