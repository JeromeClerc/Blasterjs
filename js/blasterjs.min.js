$(document).ready(function(){function e(e){if(e==="up"){$("#drone").children("img").attr("src","images/drone-top.png");Drone.orient="up"}if(e==="down"){$("#drone").children("img").attr("src","images/drone-bot.png");Drone.orient="down"}if(e==="left"){$("#drone").children("img").attr("src","images/drone-lft.png");Drone.orient="left"}if(e==="right"){$("#drone").children("img").attr("src","images/drone-rgt.png");Drone.orient="right"}}function t(){if(!l("down")){o("down");c()}}function n(){l("up")||o("up")}function r(){l("left")||o("left")}function i(){l("right")||o("right")}function s(){if(Drone.orient==="up")var e=Drone.coordY-20,t=Drone.coordX;if(Drone.orient==="down")var e=Drone.coordY+20,t=Drone.coordX;if(Drone.orient==="left")var e=Drone.coordY,t=Drone.coordX-20;if(Drone.orient==="right")var e=Drone.coordY,t=Drone.coordX+20;$("#grid-wrapper").append('<div class="fire" style="top:'+e+"px;left:"+t+'px;"><img src="images/blast-center.png"></div>');f(e,t);$(".fire").delay(300).fadeOut("fast")}function o(e){e==="down"&&$("#drone").animate({top:Drone.coordY+"px"},u(Drone.coordY-DroneOrigin.coordY));e==="up"&&$("#drone").animate({top:Drone.coordY+"px"},u(DroneOrigin.coordY-Drone.coordY));e==="left"&&$("#drone").animate({left:Drone.coordX+"px"},u(DroneOrigin.coordX-Drone.coordX));e==="right"&&$("#drone").animate({left:Drone.coordX+"px"},u(Drone.coordX-DroneOrigin.coordX))}function u(e){return 300*(parseInt(e)/20)}function a(){DroneOrigin={coordX:Drone.coordX,coordY:Drone.coordY}}function f(e,t){for(var n=1;n<Grid.length;n++)if(Grid[n].coordY===e&&Grid[n].coordX===t&&Grid[n].type===2){Grid[n].type=1;$("#tile-"+n).children("img").attr("src","images/ground.jpg")}}function l(e){if(e==="down"&&Drone.coordY<380)for(var t=1;t<Grid.length;t++)if(Grid[t].coordY===Drone.coordY+20&&Grid[t].coordX===Drone.coordX){if(Grid[t].type===1){Drone.coordY=Drone.coordY+20;l("down");break}return!1}if(e==="up"&&Drone.coordY>0)for(var t=1;t<Grid.length;t++)if(Grid[t].coordY===Drone.coordY-20&&Grid[t].coordX===Drone.coordX){if(Grid[t].type===1){Drone.coordY=Drone.coordY-20;l("up");break}return!1}if(e==="left"&&Drone.coordX>0)for(var t=1;t<Grid.length;t++)if(Grid[t].coordY===Drone.coordY&&Grid[t].coordX===Drone.coordX-20){if(Grid[t].type===1){Drone.coordX=Drone.coordX-20;l("left");break}return!1}if(e==="right"&&Drone.coordX<380)for(var t=1;t<Grid.length;t++)if(Grid[t].coordY===Drone.coordY&&Grid[t].coordX===Drone.coordX+20){if(Grid[t].type===1){Drone.coordX=Drone.coordX+20;l("right");break}return!1}}function c(){Drone.coordX===Goal.coordX&&Drone.coordY===Goal.coordY&&d(!0)}function h(e){var t=e*10;Score+=t;$("#score").empty().append(Score);parseInt(e)===2048&&d(!0)}function p(){w();v();E();g();y();$(".end-game").hide()}function d(e){Game=!1;e===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}function v(){Grid=[];var e=0,t=0;for(var n=1;n<401;n++){Grid.push({type:m(),coordX:e,coordY:t});e===parseInt(380)?e=0:e+=20;n%20===0&&(t+=20)}}function m(){var e=Math.floor(Math.random()*100+1);if(e<=50)var t=1;else if(e>=51&&e<=75)var t=2;else var t=3;return t}function g(){var e=Math.floor(Math.random()*400+1);if(Grid[e].type!==1)g();else{$("#grid-wrapper").append('<div class="perso" id="drone" style="top:'+Grid[e].coordY+"px;left:"+Grid[e].coordX+'px;"><img src="images/drone-top.png"></div>');Drone={coordX:Grid[e].coordX,coordY:Grid[e].coordY,orient:"up"}}}function y(){var e=Math.floor(Math.random()*400+1);if(Grid[e].type!==1)y();else{$("#grid-wrapper").append('<div class="goal" id="goal" style="top:'+Grid[e].coordY+"px;left:"+Grid[e].coordX+'px;"><img src="images/goal.jpg"></div>');Goal={coordX:Grid[e].coordX,coordY:Grid[e].coordY}}}function b(){Score=0;$("#score").empty().append(Score)}function w(){Game=!0}function E(){$("#grid-wrapper").empty();for(var e in Grid)$("#grid-wrapper").append('<div class="tile" id="tile-'+e+'" style="top:'+Grid[e].coordY+"px;left:"+Grid[e].coordX+'px;"><img src="images/'+S(Grid[e].type)+'"></div>')}function S(e){switch(e){case 1:var t="ground.jpg";break;case 2:var t="breakable-wall.jpg";break;case 3:var t="unbreakable-wall.jpg";break;default:var t="ground.jpg"}return t}function d(e){Game=!1;e===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}KEY_DOWN=40;KEY_UP=38;KEY_LEFT=37;KEY_RIGHT=39;KEY_ENTER=13;KEY_ESC=27;KEY_SPACE=32;p();$("body").on("click","a.button",function(){$(this).attr("role")==="new-game"&&p()});$(document).on("keydown",function(o){if(Game){a();if(o.keyCode===KEY_LEFT){console.log("LEFT");e("left");r()}if(o.keyCode===KEY_RIGHT){console.log("RIGHT");e("right");i()}if(o.keyCode===KEY_UP){console.log("UP");e("up");n()}if(o.keyCode===KEY_DOWN){console.log("DOWN");e("down");t()}if(o.keyCode===KEY_SPACE){console.log("FIRE");s()}}})});