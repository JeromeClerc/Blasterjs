$(document).ready(function(){function r(){for(var e=1;17>e;e++)if(13>e&&0!==parseInt(Grid[e])){var n=e+4;if(t(n)){o(e,n,Grid[e]);var i=!0}else if(parseInt(Grid[e])===parseInt(Grid[n])){d(e,n,Grid[e]);var i=!0}}return i?(r(),void 0):!1}function e(){for(var r=1;17>r;r++)if(r>4&&0!==parseInt(Grid[r])){var n=r-4;if(t(n)){o(r,n,Grid[r]);var i=!0}else if(parseInt(Grid[r])===parseInt(Grid[n])){d(r,n,Grid[r]);var i=!0}}return i?(e(),void 0):!1}function n(){for(var r=1;17>r;r++)if(1===parseInt(r)||5===parseInt(r)||9===parseInt(r)||13===parseInt(r))console.log("Already to the left side");else if(0!==parseInt(Grid[r])){var e=r-1;if(t(e)){o(r,e,Grid[r]);var i=!0}else if(parseInt(Grid[r])===parseInt(Grid[e])){d(r,e,Grid[r]);var i=!0}}return i?(n(),void 0):!1}function i(){for(var r=1;17>r;r++)if(4===parseInt(r)||8===parseInt(r)||12===parseInt(r)||16===parseInt(r))console.log("Already to the right side");else if(0!==parseInt(Grid[r])){var e=r+1;if(t(e)){o(r,e,Grid[r]);var n=!0}else if(parseInt(Grid[r])===parseInt(Grid[e])){d(r,e,Grid[r]);var n=!0}}return n?(i(),void 0):!1}function a(){for(var r=!0,e=1;17>e;e++)0===Grid[e]&&(r=!1);return r}function t(r){var e=!1;return 17>r&&0===Grid[r]?!0:e}function o(r,e,n){Grid[r]=0,Grid[e]=n}function d(r,e,n){Grid[r]=parseInt(0),Grid[e]=parseInt(n)+parseInt(n),p(n),m()}function p(r){var e=10*r;Score+=e,$("#score").empty().append(Score),2048===parseInt(r)&&G(!0)}function s(){Moves+=1,$("#moves").empty().append(Moves)}function f(){l(),u(),y(),$(".end-game").hide()}function G(r){Game=!1,r===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}function u(){Grid=[];for(var r=0,e=0,n=1;401>n;n++)Grid.push({type:c(),coordX:r,coordY:e}),r===parseInt(380)?r=0:r+=20,0===n%20&&(e+=20)}function c(){return Math.floor(3*Math.random()+1)}function l(){Game=!0}function v(){var r=Math.floor(16*Math.random()+1),e=Math.floor(100*Math.random()+1);0!==Grid[r]?v():Grid[r]=I(e),m()}function I(r){if(90>r)var e=2;else var e=4;return e}function m(){buildEmptyGrid();for(var r=1;17>r;r++)0!==Grid[r]&&$("#tile-"+r).addClass(TilesClass[Grid[r]]).empty().append(Grid[r])}function y(){$("#grid-wrapper").empty();for(var r in Grid)$("#grid-wrapper").append('<div class="tile" style="top:'+Grid[r].coordY+"px;left:"+Grid[r].coordX+'px;"><img src="images/'+E(Grid[r].type)+'"></div>')}function E(r){switch(r){case 1:var e="ground.jpg";break;case 2:var e="breakable-wall.jpg";break;case 3:var e="unbreakable-wall.jpg";break;default:var e="ground.jpg"}return e}KEY_DOWN=40,KEY_UP=38,KEY_LEFT=37,KEY_RIGHT=39,f(),$("body").on("click","a.button",function(){"new-game"===$(this).attr("role")&&f()}),$(document).on("keyup",function(t){Game&&(t.keyCode===KEY_LEFT&&(n()?v():a()?G(!1):v()),t.keyCode===KEY_RIGHT&&(i()?v():a()?G(!1):v()),t.keyCode===KEY_UP&&(e()?v():a()?G(!1):v()),t.keyCode===KEY_DOWN&&(r()?v():a()?G(!1):v()),(t.keyCode===KEY_LEFT||t.keyCode===KEY_DOWN||t.keyCode===KEY_UP||t.keyCode===KEY_RIGHT)&&s())}),$("#grid-wrapper").swipe({swipe:function(t,o){Game&&("left"===o&&(n()?v():a()?G(!1):v()),"right"===o&&(i()?v():a()?G(!1):v()),"up"===o&&(e()?v():a()?G(!1):v()),"down"===o&&(r()?v():a()?G(!1):v()),("left"===o||"right"===o||"up"===o||"down"===o)&&s())}})});