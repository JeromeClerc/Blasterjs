$(document).ready(function(){function e(e){e==="up"&&$("#drone").attr("src","images/drone-top.png");e==="down"&&$("#drone").attr("src","images/drone-bot.png");e==="left"&&$("#drone").attr("src","images/drone-lft.png");e==="right"&&$("#drone").attr("src","images/drone-rgt.png")}function t(){if(!n("down")){console.log("New Drone Y : "+Drone.coordY);console.log("Start to move")}}function n(e){if(e==="down"&&Drone.coordY<380){for(var t=1;t<Grid.length;t++)if(Grid[t].coordY===Drone.coordY+20)if(Grid[t].type===1){console.log("Grid Y = Drone Y + 20");console.log("Type : "+Grid[t].type);console.log("terrain libre")}else console.log("terrain occupÃ©")}else console.log("Deja tout en bas")}function r(){for(var e=1;e<17;e++)if(e>4&&parseInt(Grid[e])!==0){var t=e-4;if(checkIfSlotIsFree(t)){saveTilesPosition(e,t,Grid[e]);var n=!0}else if(parseInt(Grid[e])===parseInt(Grid[t])){mergeTiles(e,t,Grid[e]);var n=!0}}if(!n)return!1;r()}function i(){for(var e=1;e<17;e++)if(parseInt(e)===1||parseInt(e)===5||parseInt(e)===9||parseInt(e)===13)console.log("Already to the left side");else if(parseInt(Grid[e])!==0){var t=e-1;if(checkIfSlotIsFree(t)){saveTilesPosition(e,t,Grid[e]);var n=!0}else if(parseInt(Grid[e])===parseInt(Grid[t])){mergeTiles(e,t,Grid[e]);var n=!0}}if(!n)return!1;i()}function s(){for(var e=1;e<17;e++)if(parseInt(e)===4||parseInt(e)===8||parseInt(e)===12||parseInt(e)===16)console.log("Already to the right side");else if(parseInt(Grid[e])!==0){var t=e+1;if(checkIfSlotIsFree(t)){saveTilesPosition(e,t,Grid[e]);var n=!0}else if(parseInt(Grid[e])===parseInt(Grid[t])){mergeTiles(e,t,Grid[e]);var n=!0}}if(!n)return!1;s()}function o(e){var t=e*10;Score+=t;$("#score").empty().append(Score);parseInt(e)===2048&&a(!0)}function u(){p();f();d();c();$(".end-game").hide()}function a(e){Game=!1;e===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}function f(){Grid=[];var e=0,t=0;for(var n=1;n<401;n++){Grid.push({type:l(),coordX:e,coordY:t});e===parseInt(380)?e=0:e+=20;n%20===0&&(t+=20)}}function l(){return Math.floor(Math.random()*3+1)}function c(){var e=Math.floor(Math.random()*400+1);if(Grid[e].type!==1)c();else{$("#grid-wrapper").append('<div class="perso" style="top:'+Grid[e].coordY+"px;left:"+Grid[e].coordX+'px;"><img src="images/drone-top.png" id="drone"></div>');Drone={coordX:Grid[e].coordX,coordY:Grid[e].coordY}}}function h(){Score=0;$("#score").empty().append(Score)}function p(){Game=!0}function d(){$("#grid-wrapper").empty();for(var e in Grid)$("#grid-wrapper").append('<div class="tile" style="top:'+Grid[e].coordY+"px;left:"+Grid[e].coordX+'px;"><img src="images/'+v(Grid[e].type)+'"></div>')}function v(e){switch(e){case 1:var t="ground.jpg";break;case 2:var t="ground.jpg";break;case 3:var t="ground.jpg";break;default:var t="ground.jpg"}return t}KEY_DOWN=40;KEY_UP=38;KEY_LEFT=37;KEY_RIGHT=39;u();$("body").on("click","a.button",function(){$(this).attr("role")==="new-game"&&u()});$(document).on("keyup",function(n){if(Game){if(n.keyCode===KEY_LEFT){console.log("LEFT");e("left")}if(n.keyCode===KEY_RIGHT){console.log("RIGHT");e("right")}if(n.keyCode===KEY_UP){console.log("UP");e("up")}if(n.keyCode===KEY_DOWN){console.log("DOWN");e("down");t()}}})});