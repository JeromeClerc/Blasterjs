$(document).ready(function(){function o(o){"up"===o&&($("#drone").children("img").attr("src","images/drone-top.png"),Drone.orient="up"),"down"===o&&($("#drone").children("img").attr("src","images/drone-bot.png"),Drone.orient="down"),"left"===o&&($("#drone").children("img").attr("src","images/drone-lft.png"),Drone.orient="left"),"right"===o&&($("#drone").children("img").attr("src","images/drone-rgt.png"),Drone.orient="right")}function r(){f("down")||a("down")}function e(){f("up")||a("up")}function d(){f("left")||a("left")}function n(){f("right")||a("right")}function i(){if(Laser>0){if("up"===Drone.orient)var o=Drone.coordY-20,r=Drone.coordX;if("down"===Drone.orient)var o=Drone.coordY+20,r=Drone.coordX;if("left"===Drone.orient)var o=Drone.coordY,r=Drone.coordX-20;if("right"===Drone.orient)var o=Drone.coordY,r=Drone.coordX+20;$("#grid-wrapper").append('<div class="fire" style="top:'+o+"px;left:"+r+'px;"><img src="images/blast-center.png"></div>'),l(o,r),$(".fire").delay(300).fadeOut("fast"),t("fire")}}function t(o){"fire"===o?Laser-=10:Laser+=10,$(".power-lvl").animate({width:Laser+"%"},"fast"),$(".power-lvl-txt").empty().append(Laser+"%")}function a(o){"down"===o&&$("#drone").animate({top:Drone.coordY+"px"},c(Drone.coordY-DroneOrigin.coordY)),"up"===o&&$("#drone").animate({top:Drone.coordY+"px"},c(DroneOrigin.coordY-Drone.coordY)),"left"===o&&$("#drone").animate({left:Drone.coordX+"px"},c(DroneOrigin.coordX-Drone.coordX)),"right"===o&&$("#drone").animate({left:Drone.coordX+"px"},c(Drone.coordX-DroneOrigin.coordX))}function c(o){return 300*(parseInt(o)/20)}function p(){DroneOrigin={coordX:Drone.coordX,coordY:Drone.coordY}}function l(o,r){for(var e=1;e<Grid.length;e++)Grid[e].coordY===o&&Grid[e].coordX===r&&2===Grid[e].type&&(Grid[e].type=1,$("#tile-"+e).children("img").attr("src","images/ground.jpg")),Grid[e].coordY===o&&Grid[e].coordX===r&&4===Grid[e].type&&(Grid[e].type=1,$("#tile-"+e).children("img").attr("src","images/ground.jpg")),Grid[e].coordY===o&&Grid[e].coordX===r&&3===Grid[e].type&&(Grid[e].type=4,$("#tile-"+e).children("img").attr("src","images/fissured-wall.jpg"))}function f(o){if("down"===o&&Drone.coordY<380)for(var r=1;r<Grid.length;r++)if(Grid[r].coordY===Drone.coordY+20&&Grid[r].coordX===Drone.coordX){if(1===Grid[r].type){Drone.coordY=Drone.coordY+20,g(),s(),f("down");break}return!1}if("up"===o&&Drone.coordY>0)for(var r=1;r<Grid.length;r++)if(Grid[r].coordY===Drone.coordY-20&&Grid[r].coordX===Drone.coordX){if(1===Grid[r].type){Drone.coordY=Drone.coordY-20,g(),s(),f("up");break}return!1}if("left"===o&&Drone.coordX>0)for(var r=1;r<Grid.length;r++)if(Grid[r].coordY===Drone.coordY&&Grid[r].coordX===Drone.coordX-20){if(1===Grid[r].type){Drone.coordX=Drone.coordX-20,g(),s(),f("left");break}return!1}if("right"===o&&Drone.coordX<380)for(var r=1;r<Grid.length;r++)if(Grid[r].coordY===Drone.coordY&&Grid[r].coordX===Drone.coordX+20){if(1===Grid[r].type){Drone.coordX=Drone.coordX+20,g(),s(),f("right");break}return!1}}function g(){Drone.coordX===Goal.coordX&&Drone.coordY===Goal.coordY&&($("#drone").animate({top:Goal.coordY+"px",left:Goal.coordX+"px"},c(Drone.coordX-DroneOrigin.coordX)),Y(!0),$("#drone").stop(!0,!0))}function s(){for(var o in Reload)Drone.coordX===Reload[o].coordX&&Drone.coordY===Reload[o].coordY&&100>Laser&&(t("reload"),$("#reload-"+o).remove())}function u(){E(),D(),x(),m(),X(),h(),v(),$(".end-game").hide()}function Y(o){Game=!1,o===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}function D(){Grid=[];for(var o=0,r=0,e=1;401>e;e++)Grid.push({type:G(),coordX:o,coordY:r}),o===parseInt(380)?o=0:o+=20,0===e%20&&(r+=20)}function G(){var o=Math.floor(100*Math.random()+1);if(50>=o)var r=1;else if(o>=51&&74>=o)var r=2;else if(o>=75&&98>=o)var r=3;else var r=4;return r}function m(){var o=Math.floor(400*Math.random()+1);1!==Grid[o].type?m():($("#grid-wrapper").append('<div class="perso" id="drone" style="top:'+Grid[o].coordY+"px;left:"+Grid[o].coordX+'px;"><img src="images/drone-top.png"></div>'),Drone={coordX:Grid[o].coordX,coordY:Grid[o].coordY,orient:"up"})}function X(){var o=Math.floor(400*Math.random()+1);1!==Grid[o].type?X():($("#grid-wrapper").append('<div class="goal" id="goal" style="top:'+Grid[o].coordY+"px;left:"+Grid[o].coordX+'px;"><img src="images/goal.jpg"></div>'),Goal={coordX:Grid[o].coordX,coordY:Grid[o].coordY})}function h(){Laser=100,$(".power-lvl").css({width:Laser+"%"}),$(".power-lvl-txt").empty().append(Laser+"%")}function v(){Reload=[],w(),y()}function y(){for(var o in Reload)$("#grid-wrapper").append('<div class="reload" id="reload-'+o+'" style="top:'+Reload[o].coordY+"px;left:"+Reload[o].coordX+'px;"><img src="images/energy.png"></div>')}function w(){for(;Reload.length<4;){var o=Math.floor(400*Math.random()+1);1!==Grid[o].type?(delete o,w()):Reload.push({coordX:Grid[o].coordX,coordY:Grid[o].coordY})}}function E(){Game=!0}function x(){$("#grid-wrapper").empty();for(var o in Grid)$("#grid-wrapper").append('<div class="tile" id="tile-'+o+'" style="top:'+Grid[o].coordY+"px;left:"+Grid[o].coordX+'px;"><img src="images/'+k(Grid[o].type)+'"></div>')}function k(o){switch(o){case 1:var r="ground.jpg";break;case 2:var r="breakable-wall.jpg";break;case 3:var r="unbreakable-wall.jpg";break;case 4:var r="fissured-wall.jpg";break;default:var r="ground.jpg"}return r}function Y(o){Game=!1,o===!0?$(".end-game").empty().append("YOU WIN !!!").show():$(".end-game").empty().append("YOU LOOSE :'(").show()}KEY_DOWN=40,KEY_UP=38,KEY_LEFT=37,KEY_RIGHT=39,KEY_ENTER=13,KEY_ESC=27,KEY_SPACE=32,u(),$("body").on("click","a.button",function(){"new-game"===$(this).attr("role")&&u()}),$(document).on("keydown",function(t){Game&&(p(),t.keyCode===KEY_LEFT&&(o("left"),d()),t.keyCode===KEY_RIGHT&&(o("right"),n()),t.keyCode===KEY_UP&&(o("up"),e()),t.keyCode===KEY_DOWN&&(o("down"),r()),t.keyCode===KEY_SPACE&&i())})});